{"zebra1": {"cmd_|-restart_service_|-systemctl reload php7.0-fpm.service && systemctl reload nginx.service_|-run": {"comment": "Command \"systemctl reload php7.0-fpm.service && systemctl reload nginx.service\" run", "name": "systemctl reload php7.0-fpm.service && systemctl reload nginx.service", "start_time": "13:01:13.486828", "result": false, "duration": 35.279, "__run_num__": 3, "changes": {"pid": 3366, "retcode": 1, "stderr": "Job for nginx.service failed. See 'systemctl status nginx.service' and 'journalctl -xn' for details.", "stdout": ""}, "__id__": "restart_service"}, "cmd_|-releases_cleanup_|-echo `date +%Y-%m-%d_%H:%M:%S`\" DEBUG: The following files are going to be removed:\" >> /srv/www/debug_releases_cleanup; find -maxdepth 1 ! -newer $(ls -tp | tail -n +6 | head -1) ! -name \"$(date --date=\"today\" +%Y%m%d)*\" ! -name \"$(date --date=\"yesterday\" +%Y%m%d)*\" >> /srv/www/debug_releases_cleanup; find -maxdepth 1 ! -newer $(ls -tp | tail -n +6 | head -1) ! -name \"$(date --date=\"today\" +%Y%m%d)*\" ! -name \"$(date --date=\"yesterday\" +%Y%m%d)*\" -exec rm -rf {} \\; >> /srv/www/debug_releases_cleanup ;_|-run": {"comment": "One or more requisite failed: testdeploy.deploy.restart_service", "__run_num__": 4, "__sls__": "testdeploy.deploy", "changes": {}, "result": false}, "cmd_|-app_post_deploy_local_|-cd /srv/www/zebra/latest && APP_ENV=production composer --no-dev install && composer --no-dev update && composer dumpautoload && echo APP_ENV=production > /srv/www/zebra/latest/.env_|-run": {"comment": "Command \"cd /srv/www/zebra/latest && APP_ENV=production composer --no-dev install && composer --no-dev update && composer dumpautoload && echo APP_ENV=production > /srv/www/zebra/latest/.env\" run", "name": "cd /srv/www/zebra/latest && APP_ENV=production composer --no-dev install && composer --no-dev update && composer dumpautoload && echo APP_ENV=production > /srv/www/zebra/latest/.env", "start_time": "13:00:15.837460", "result": true, "duration": 57647.815, "__run_num__": 1, "changes": {"pid": 3298, "retcode": 0, "stderr": "Warning: This development build of composer is over 60 days old. It is recommended to update it by running \"/usr/local/bin/composer self-update\" to get the latest version.\nLoading composer repositories with package information\nInstalling dependencies from lock file\nNothing to install or update\nGenerating autoload files\nWarning: This development build of composer is over 60 days old. It is recommended to update it by running \"/usr/local/bin/composer self-update\" to get the latest version.\nLoading composer repositories with package information\nUpdating dependencies\nNothing to install or update\nWriting lock file\nGenerating autoload files\nWarning: This development build of composer is over 60 days old. It is recommended to update it by running \"/usr/local/bin/composer self-update\" to get the latest version.\nGenerating autoload files", "stdout": ""}, "__id__": "app_post_deploy_local"}, "testdeploy_|-deploy_|-zebra_|-deploy": {"comment": "READ FROM THE BEGINNING!", "name": "zebra", "start_time": "13:00:13.516143", "result": true, "duration": 2320.37, "__run_num__": 0, "changes": {"new": ["application repo is /srv/www/zebra/repo\nrelease path will be /srv/www/zebra/releases/20180131130013", "Current branch in /srv/www/zebra/repo is master ", "SHA ref not changed: 09662ddc92814ae7f96acead5a1a3f9257055a04 -> 09662ddc92814ae7f96acead5a1a3f9257055a04", "copied /srv/www/zebra/repo to  /srv/www/zebra/releases/20180131130013", "Linked /srv/www/zebra/shared/dummy.yml ->  /srv/www/zebra/releases/20180131130013/dummy.yml", "Linked shared directories /srv/www/zebra/shared/vendor ->  /srv/www/zebra/releases/20180131130013/vendor", "Cannot link /srv/www/zebra/shared/storage/logs to /srv/www/zebra/releases/20180131130013/storage/logs, destination directory exists (This directory is most likely under git", "Linked shared directories /srv/www/zebra/shared/storage/apps ->  /srv/www/zebra/releases/20180131130013/storage/apps", "Cannot link /srv/www/zebra/shared/storage/framework to /srv/www/zebra/releases/20180131130013/storage/framework, destination directory exists (This directory is most likely under git", "Linked /srv/www/zebra/releases/20180131130013 ->  /srv/www/zebra/latest"]}, "__id__": "deploy"}, "testdeploy_|-link_current_|-zebra_|-link_current": {"comment": "", "name": "zebra", "start_time": "13:01:13.485701", "result": true, "duration": 0.757, "__run_num__": 2, "changes": {"new": ["Linked /srv/www/zebra/releases/20180131130013 ->  /srv/www/zebra/current"]}, "__id__": "link_current"}}}
{"zebra2": {"cmd_|-restart_service_|-systemctl reload php7.0-fpm.service && systemctl reload nginx.service_|-run": {"comment": "Command \"systemctl reload php7.0-fpm.service && systemctl reload nginx.service\" run", "name": "systemctl reload php7.0-fpm.service && systemctl reload nginx.service", "start_time": "13:01:21.649535", "result": true, "duration": 37.775, "__run_num__": 3, "changes": {"pid": 2526, "retcode": 0, "stderr": "", "stdout": ""}, "__id__": "restart_service"}, "cmd_|-releases_cleanup_|-echo `date +%Y-%m-%d_%H:%M:%S`\" DEBUG: The following files are going to be removed:\" >> /srv/www/debug_releases_cleanup; find -maxdepth 1 ! -newer $(ls -tp | tail -n +6 | head -1) ! -name \"$(date --date=\"today\" +%Y%m%d)*\" ! -name \"$(date --date=\"yesterday\" +%Y%m%d)*\" >> /srv/www/debug_releases_cleanup; find -maxdepth 1 ! -newer $(ls -tp | tail -n +6 | head -1) ! -name \"$(date --date=\"today\" +%Y%m%d)*\" ! -name \"$(date --date=\"yesterday\" +%Y%m%d)*\" -exec rm -rf {} \\; >> /srv/www/debug_releases_cleanup ;_|-run": {"comment": "Command \"echo `date +%Y-%m-%d_%H:%M:%S`\" DEBUG: The following files are going to be removed:\" >> /srv/www/debug_releases_cleanup; find -maxdepth 1 ! -newer $(ls -tp | tail -n +6 | head -1) ! -name \"$(date --date=\"today\" +%Y%m%d)*\" ! -name \"$(date --date=\"yesterday\" +%Y%m%d)*\" >> /srv/www/debug_releases_cleanup; find -maxdepth 1 ! -newer $(ls -tp | tail -n +6 | head -1) ! -name \"$(date --date=\"today\" +%Y%m%d)*\" ! -name \"$(date --date=\"yesterday\" +%Y%m%d)*\" -exec rm -rf {} \\; >> /srv/www/debug_releases_cleanup ;\" run", "name": "echo `date +%Y-%m-%d_%H:%M:%S`\" DEBUG: The following files are going to be removed:\" >> /srv/www/debug_releases_cleanup; find -maxdepth 1 ! -newer $(ls -tp | tail -n +6 | head -1) ! -name \"$(date --date=\"today\" +%Y%m%d)*\" ! -name \"$(date --date=\"yesterday\" +%Y%m%d)*\" >> /srv/www/debug_releases_cleanup; find -maxdepth 1 ! -newer $(ls -tp | tail -n +6 | head -1) ! -name \"$(date --date=\"today\" +%Y%m%d)*\" ! -name \"$(date --date=\"yesterday\" +%Y%m%d)*\" -exec rm -rf {} \\; >> /srv/www/debug_releases_cleanup ;", "start_time": "13:01:21.687581", "result": true, "duration": 81.039, "__run_num__": 4, "changes": {"pid": 2555, "retcode": 0, "stderr": "", "stdout": ""}, "__id__": "releases_cleanup"}, "cmd_|-app_post_deploy_local_|-cd /srv/www/zebra/latest && APP_ENV=production composer --no-dev install && composer --no-dev update && composer dumpautoload && echo APP_ENV=production > /srv/www/zebra/latest/.env_|-run": {"comment": "Command \"cd /srv/www/zebra/latest && APP_ENV=production composer --no-dev install && composer --no-dev update && composer dumpautoload && echo APP_ENV=production > /srv/www/zebra/latest/.env\" run", "name": "cd /srv/www/zebra/latest && APP_ENV=production composer --no-dev install && composer --no-dev update && composer dumpautoload && echo APP_ENV=production > /srv/www/zebra/latest/.env", "start_time": "13:00:15.401594", "result": true, "duration": 66246.96, "__run_num__": 1, "changes": {"pid": 2475, "retcode": 0, "stderr": "Warning: This development build of composer is over 60 days old. It is recommended to update it by running \"/usr/local/bin/composer self-update\" to get the latest version.\nLoading composer repositories with package information\nInstalling dependencies from lock file\nNothing to install or update\nGenerating autoload files\nWarning: This development build of composer is over 60 days old. It is recommended to update it by running \"/usr/local/bin/composer self-update\" to get the latest version.\nLoading composer repositories with package information\nUpdating dependencies\nNothing to install or update\nWriting lock file\nGenerating autoload files\nWarning: This development build of composer is over 60 days old. It is recommended to update it by running \"/usr/local/bin/composer self-update\" to get the latest version.\nGenerating autoload files", "stdout": ""}, "__id__": "app_post_deploy_local"}, "testdeploy_|-deploy_|-zebra_|-deploy": {"comment": "READ FROM THE BEGINNING!", "name": "zebra", "start_time": "13:00:13.203484", "result": true, "duration": 2197.384, "__run_num__": 0, "changes": {"new": ["application repo is /srv/www/zebra/repo\nrelease path will be /srv/www/zebra/releases/20180131130013", "Current branch in /srv/www/zebra/repo is master ", "SHA ref not changed: 09662ddc92814ae7f96acead5a1a3f9257055a04 -> 09662ddc92814ae7f96acead5a1a3f9257055a04", "copied /srv/www/zebra/repo to  /srv/www/zebra/releases/20180131130013", "Linked /srv/www/zebra/shared/dummy.yml ->  /srv/www/zebra/releases/20180131130013/dummy.yml", "Linked shared directories /srv/www/zebra/shared/vendor ->  /srv/www/zebra/releases/20180131130013/vendor", "Cannot link /srv/www/zebra/shared/storage/logs to /srv/www/zebra/releases/20180131130013/storage/logs, destination directory exists (This directory is most likely under git", "Linked shared directories /srv/www/zebra/shared/storage/apps ->  /srv/www/zebra/releases/20180131130013/storage/apps", "Cannot link /srv/www/zebra/shared/storage/framework to /srv/www/zebra/releases/20180131130013/storage/framework, destination directory exists (This directory is most likely under git", "Linked /srv/www/zebra/releases/20180131130013 ->  /srv/www/zebra/latest"]}, "__id__": "deploy"}, "testdeploy_|-link_current_|-zebra_|-link_current": {"comment": "", "name": "zebra", "start_time": "13:01:21.648870", "result": true, "duration": 0.385, "__run_num__": 2, "changes": {"new": ["Linked /srv/www/zebra/releases/20180131130013 ->  /srv/www/zebra/current"]}, "__id__": "link_current"}}}
